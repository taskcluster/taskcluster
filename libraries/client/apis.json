{
  "Auth": {
    "referenceUrl": "http://references.taskcluster.net/auth/v1/api.json",
    "reference": {
      "version": "0.2.0",
      "title": "Authentication API",
      "description": "Authentication related API end-points for taskcluster.",
      "baseUrl": "https://auth.taskcluster.net/v1",
      "entries": [
        {
          "type": "function",
          "method": "get",
          "route": "/client/<clientId>/scopes",
          "args": [
            "clientId"
          ],
          "name": "inspect",
          "title": "Get Client Authorized Scopes",
          "description": "Returns the scopes the client is authorized to access and the date-time\nwhere the clients authorization is set to expire.\n\nThis API end-point allows you inspect clients without getting access to\ncredentials, as provide by the `getCredentials` request below.",
          "scopes": [
            [
              "auth:inspect"
            ],
            [
              "auth:credentials"
            ]
          ],
          "output": "http://schemas.taskcluster.net/auth/v1/client-scopes-response.json#"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/client/<clientId>/credentials",
          "args": [
            "clientId"
          ],
          "name": "getCredentials",
          "title": "Get Client Credentials",
          "description": "Returns the clients `accessToken` as needed for verifying signatures.\nThis API end-point also returns the list of scopes the client is\nauthorized for and the date-time where the client authorization expires\n\nRemark, **if you don't need** the `accessToken` but only want to see what\nscopes a client is authorized for, you should use the `getScopes`\nfunction described above.",
          "scopes": [
            [
              "auth:credentials"
            ]
          ],
          "output": "http://schemas.taskcluster.net/auth/v1/client-credentials-response.json#"
        }
      ]
    }
  },
  "Queue": {
    "referenceUrl": "http://references.taskcluster.net/queue/v1/api.json",
    "reference": {
      "version": "0.2.0",
      "title": "Queue API Documentation",
      "description": "The queue, typically available at `queue.taskcluster.net`, is responsible\nfor accepting tasks and track their state as they are executed by\nworkers. In order ensure they are eventually resolved.\n\nThis document describes the API end-points offered by the queue. These \nend-points targets the following audience:\n * Schedulers, who create tasks to be executed,\n * Workers, who execute tasks, and\n * Tools, that wants to inspect the state of a task.",
      "baseUrl": "https://queue.taskcluster.net/v1",
      "entries": [
        {
          "type": "function",
          "method": "put",
          "route": "/task/<taskId>",
          "args": [
            "taskId"
          ],
          "name": "createTask",
          "title": "Create new task",
          "description": "Create a new task, this is an **idempotent** operation, so repeat it if\nyou get an internal server error.\nDeadline is at most 7 days into the future",
          "scopes": [
            [
              "queue:create-task:<provisionerId>/<workerType>"
            ]
          ],
          "input": "http://schemas.taskcluster.net/queue/v1/task.json#",
          "output": "http://schemas.taskcluster.net/queue/v1/task-status-response.json#"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task/<taskId>",
          "args": [
            "taskId"
          ],
          "name": "getTask",
          "title": "Fetch Task",
          "description": "Get task definition from queue.",
          "output": "http://schemas.taskcluster.net/queue/v1/task.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/task/<taskId>/define",
          "args": [
            "taskId"
          ],
          "name": "defineTask",
          "title": "Define Task",
          "description": "Define a task without scheduling it. This API end-point allows you to\nupload a task definition without having scheduled. The task won't be\nreported as pending until it is scheduled, see the scheduleTask API \nend-point.\n\nThe purpose of this API end-point is allow schedulers to upload task\ndefinitions without the tasks becoming _pending_ immediately. This useful\nif you have a set of dependent tasks. Then you can upload all the tasks\nand when the dependencies of a tasks have been resolved, you can schedule\nthe task by calling `/task/:taskId/schedule`. This eliminates the need to\nstore tasks somewhere else while waiting for dependencies to resolve.\n\n**Note** this operation is **idempotent**, as long as you upload the same\ntask definition as previously defined this operation is safe to retry.",
          "scopes": [
            [
              "queue:define-task:<provisionerId>/<workerType>"
            ],
            [
              "queue:create-task:<provisionerId>/<workerType>"
            ]
          ],
          "input": "http://schemas.taskcluster.net/queue/v1/task.json#",
          "output": "http://schemas.taskcluster.net/queue/v1/task-status-response.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/task/<taskId>/schedule",
          "args": [
            "taskId"
          ],
          "name": "scheduleTask",
          "title": "Schedule Defined Task",
          "description": "If you have define a task using `defineTask` API end-point, then you\ncan schedule the task to be scheduled using this method.\nThis will announce the task as pending and workers will be allowed, to\nclaim it and resolved the task.\n\n**Note** this operation is **idempotent** and will not fail or complain\nif called with `taskId` that is already scheduled, or even resolved.\nTo reschedule a task previously resolved, use `rerunTask`.",
          "scopes": [
            [
              "queue:schedule-task",
              "assume:scheduler-id:<schedulerId>/<taskGroupId>"
            ]
          ],
          "output": "http://schemas.taskcluster.net/queue/v1/task-status-response.json#"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task/<taskId>/status",
          "args": [
            "taskId"
          ],
          "name": "status",
          "title": "Get task status",
          "description": "Get task status structure from `taskId`",
          "output": "http://schemas.taskcluster.net/queue/v1/task-status-response.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/task/<taskId>/runs/<runId>/claim",
          "args": [
            "taskId",
            "runId"
          ],
          "name": "claimTask",
          "title": "Claim task",
          "description": "claim a task, more to be added later...",
          "scopes": [
            [
              "queue:claim-task",
              "assume:worker-type:<provisionerId>/<workerType>",
              "assume:worker-id:<workerGroup>/<workerId>"
            ]
          ],
          "input": "http://schemas.taskcluster.net/queue/v1/task-claim-request.json#",
          "output": "http://schemas.taskcluster.net/queue/v1/task-claim-response.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/task/<taskId>/runs/<runId>/reclaim",
          "args": [
            "taskId",
            "runId"
          ],
          "name": "reclaimTask",
          "title": "Reclaim task",
          "description": "reclaim a task more to be added later...",
          "scopes": [
            [
              "queue:claim-task",
              "assume:worker-id:<workerGroup>/<workerId>"
            ]
          ],
          "output": "http://schemas.taskcluster.net/queue/v1/task-claim-response.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/claim-work/<provisionerId>/<workerType>",
          "args": [
            "provisionerId",
            "workerType"
          ],
          "name": "claimWork",
          "title": "Claim work for a worker",
          "description": "Claim work for a worker, returns information about an appropriate task\nclaimed for the worker. Similar to `claimTaskRun`, which can be\nused to claim a specific task, or reclaim a specific task extending the\n`takenUntil` timeout for the run.\n\n**Note**, that if no tasks are _pending_ this method will not assign a\ntask to you. Instead it will return `204` and you should wait a while\nbefore polling the queue again. To avoid polling declare a RabbitMQ queue\nfor your `workerType` claim work using `claimTaskRun`.",
          "scopes": [
            [
              "queue:claim-task",
              "assume:worker-type:<provisionerId>/<workerType>",
              "assume:worker-id:<workerGroup>/<workerId>"
            ]
          ],
          "input": "http://schemas.taskcluster.net/queue/v1/task-claim-request.json#",
          "output": "http://schemas.taskcluster.net/queue/v1/task-claim-response.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/task/<taskId>/runs/<runId>/completed",
          "args": [
            "taskId",
            "runId"
          ],
          "name": "reportCompleted",
          "title": "Report Run Completed",
          "description": "Report a run completed, resolving the run as `completed`.",
          "scopes": [
            [
              "queue:report-task-completed",
              "assume:worker-id:<workerGroup>/<workerId>"
            ]
          ],
          "input": "http://schemas.taskcluster.net/queue/v1/task-completed-request.json#",
          "output": "http://schemas.taskcluster.net/queue/v1/task-status-response.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/task/<taskId>/rerun",
          "args": [
            "taskId"
          ],
          "name": "rerunTask",
          "title": "Rerun a Resolved Task",
          "description": "This method _reruns_ a previously resolved task, even if it was\n_completed_. This is useful if your task completes unsuccessfully, and\nyou just want to run it from scratch again. This will also reset the\nnumber of `retries` allowed.\n\nRemember that `retries` in the task status counts the number of runs that\nthe queue have started because the worker stopped responding, for example\nbecause a spot node died.\n\n**Remark** this operation is idempotent, if you try to rerun a task that\nisn't either `failed` or `completed`, this operation will just return the\ncurrent task status.",
          "scopes": [
            [
              "queue:rerun-task",
              "assume:scheduler-id:<schedulerId>/<taskGroupId>"
            ]
          ],
          "output": "http://schemas.taskcluster.net/queue/v1/task-status-response.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/task/<taskId>/runs/<runId>/artifacts/<name>",
          "args": [
            "taskId",
            "runId",
            "name"
          ],
          "name": "createArtifact",
          "title": "Create Artifact",
          "description": "TODO: document this method",
          "scopes": [
            [
              "queue:create-artifact:<name>",
              "assume:worker-id:<workerGroup>/<workerId>"
            ]
          ],
          "input": "http://schemas.taskcluster.net/queue/v1/post-artifact-request.json",
          "output": "http://schemas.taskcluster.net/queue/v1/post-artifact-response.json"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task/<taskId>/runs/<runId>/artifacts/<name>",
          "args": [
            "taskId",
            "runId",
            "name"
          ],
          "name": "getArtifactFromRun",
          "title": "Get Artifact from Run",
          "description": "TODO: document this method",
          "scopes": [
            [
              "queue:get-artifact:<name>"
            ]
          ]
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task/<taskId>/artifacts/<name>",
          "args": [
            "taskId",
            "name"
          ],
          "name": "getLatestArtifact",
          "title": "Get Artifact from Latest Run",
          "description": "TODO: document this method",
          "scopes": [
            [
              "queue:get-artifact:<name>"
            ]
          ]
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task/<taskId>/runs/<runId>/artifacts",
          "args": [
            "taskId",
            "runId"
          ],
          "name": "getArtifactsFromRun",
          "title": "Get Artifacts from Run",
          "description": "TODO: document this method"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task/<taskId>/artifacts",
          "args": [
            "taskId"
          ],
          "name": "getLatestArtifacts",
          "title": "Get Artifacts from Latest Run",
          "description": "TODO: document this method"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/pending-tasks/<provisionerId>",
          "args": [
            "provisionerId"
          ],
          "name": "getPendingTasks",
          "title": "Fetch pending tasks for provisioner",
          "description": "Documented later...\n\n**Warning** this api end-point is **not stable**."
        },
        {
          "type": "function",
          "method": "get",
          "route": "/settings/amqp-connection-string",
          "args": [],
          "name": "getAMQPConnectionString",
          "title": "Fetch AMQP Connection String",
          "description": "Most hosted AMQP services requires us to specify a virtual host, \nso hardcoding the AMQP connection string into various services would be \na bad solution. Hence, we offer all authorized queue consumers to fetch \nan AMQP connection string using the API end-point.\n\n**Warning**, this API end-point is not stable, and may change in the \nfuture the strategy of not hardcoding AMQP connection details into \nvarious components obviously makes sense. But as we have no method of \nnotifying consumers that the connection string have moved. This \napproach may not be optimal either. Thus, we may be choose to remove \nthis API end-point when `pulse.mozilla.org` is a stable AMQP service \nwe can rely on.",
          "output": "http://schemas.taskcluster.net/queue/v1/amqp-connection-string-response.json#"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/ping",
          "args": [],
          "name": "ping",
          "title": "Ping Server",
          "description": "Documented later...\n\n**Warning** this api end-point is **not stable**."
        }
      ]
    }
  },
  "QueueEvents": {
    "referenceUrl": "http://references.taskcluster.net/queue/v1/exchanges.json",
    "reference": {
      "version": "0.2.0",
      "title": "Queue AMQP Exchanges",
      "description": "The queue, typically available at `queue.taskcluster.net`, is responsible\nfor accepting tasks and track their state as they are executed by\nworkers. In order ensure they are eventually resolved.\n\nThis document describes AMQP exchanges offered by the queue, which allows\nthird-party listeners to monitor tasks as they progress to resolution.\nThese exchanges targets the following audience:\n * Schedulers, who takes action after tasks are completed,\n * Workers, who wants to listen for new or canceled tasks (optional),\n * Tools, that wants to update their view as task progress.\n\nYou'll notice that all the exchanges in the document shares the same\nrouting key pattern. This makes it very easy to bind to all message about\na certain kind tasks. You should also note that the `routing` property\nof a task will be used in the routing key. This property is user-defined\nand may contain dots (ie. multiple routing words).\n\n**Task-Graphs**, if the task-graph scheduler, documented elsewhere, is\nused to schedule a task-graph, the task submitted will have their\n`schedulerId` set to `task-graph-scheduler`, and their `taskGroupId` to\nthe `taskGraphId` as given to the task-graph scheduler. This is useful if\nyou wish to listen for all messages in a specific task-graph.\n\n**Delivery Guarantees**, most operations on the queue are idempotent,\nwhich means that if repeated with the same arguments then the requests\nwill ensure completion of the operation and return the same response.\nThis is useful if the server crashes or the TCP connection breaks, but\nwhen re-executing an idempotent operation, the queue will also resend\nany related AMQP messages. Hence, messages may be repeated.\n\nThis shouldn't be much of a problem, as the best you can achieve using\nconfirm messages with AMQP is at-least-once delivery semantics. Hence,\nthis only prevents you from obtaining at-most-once delivery semantics.\n\n**Remark**, some message generated by timeouts maybe dropped if the\nserver crashes at wrong time. Ideally, we'll address this in the\nfuture. For now we suggest you ignore this corner case.",
      "exchangePrefix": "queue/v1/",
      "entries": [
        {
          "type": "topic-exchange",
          "exchange": "task-defined",
          "name": "taskDefined",
          "title": "Task Defined Messages",
          "description": "When a task is created or just defined a message is posted to this\nexchange.\n\nThis message exchange is mainly useful when tasks are scheduled by a\nscheduler that uses `defineTask` as this does not make the task\n`pending`. Thus, no `taskPending` message is published.\nPlease, note that messages are also published on this exchange if defined\nusing `createTask`.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "`taskId` for the task this message concerns",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "runId",
              "summary": "`runId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 3
            },
            {
              "name": "workerGroup",
              "summary": "`workerGroup` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "workerId",
              "summary": "`workerId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "provisionerId",
              "summary": "`provisionerId` this task is targeted at.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "workerType",
              "summary": "`workerType` this task must run on.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "schedulerId",
              "summary": "`schedulerId` this task was created by.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "taskGroupId",
              "summary": "`taskGroupId` this task was created in.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "routing",
              "summary": "task-specific routing key (`task.routing`).",
              "multipleWords": true,
              "required": true,
              "maxSize": 90
            }
          ],
          "schema": "http://schemas.taskcluster.net/queue/v1/task-defined-message.json#"
        },
        {
          "type": "topic-exchange",
          "exchange": "task-pending",
          "name": "taskPending",
          "title": "Task Pending Messages",
          "description": "When a task becomes `pending` a message is posted to this exchange.\n\nThis is useful for workers who doesn't want to constantly poll the queue\nfor new tasks. The queue will also be authority for task states and\nclaims. But using this exchange workers should be able to distribute work\nefficiently and they would be able to reduce their polling interval\nsignificantly without affecting general responsiveness.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "`taskId` for the task this message concerns",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "runId",
              "summary": "`runId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 3
            },
            {
              "name": "workerGroup",
              "summary": "`workerGroup` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "workerId",
              "summary": "`workerId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "provisionerId",
              "summary": "`provisionerId` this task is targeted at.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "workerType",
              "summary": "`workerType` this task must run on.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "schedulerId",
              "summary": "`schedulerId` this task was created by.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "taskGroupId",
              "summary": "`taskGroupId` this task was created in.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "routing",
              "summary": "task-specific routing key (`task.routing`).",
              "multipleWords": true,
              "required": true,
              "maxSize": 90
            }
          ],
          "schema": "http://schemas.taskcluster.net/queue/v1/task-pending-message.json#"
        },
        {
          "type": "topic-exchange",
          "exchange": "task-running",
          "name": "taskRunning",
          "title": "Task Running Messages",
          "description": "Whenever a task is claimed by a worker, a run is started on the worker,\nand a message is posted on this exchange.\n\n**Notice**, that the `logsUrl` may return `404` during the run, but by\nthe end of the run the `logsUrl` will be valid. But this may not have\nhappened when this message is posted.\n\nThe idea is that workers can choose to upload the `logs.json` file as the\nfirst thing they do, in which case it'll often be available after a few\nminutes. This is useful if the worker supports live logging.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "`taskId` for the task this message concerns",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "runId",
              "summary": "`runId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 3
            },
            {
              "name": "workerGroup",
              "summary": "`workerGroup` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "workerId",
              "summary": "`workerId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "provisionerId",
              "summary": "`provisionerId` this task is targeted at.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "workerType",
              "summary": "`workerType` this task must run on.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "schedulerId",
              "summary": "`schedulerId` this task was created by.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "taskGroupId",
              "summary": "`taskGroupId` this task was created in.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "routing",
              "summary": "task-specific routing key (`task.routing`).",
              "multipleWords": true,
              "required": true,
              "maxSize": 90
            }
          ],
          "schema": "http://schemas.taskcluster.net/queue/v1/task-running-message.json#"
        },
        {
          "type": "topic-exchange",
          "exchange": "task-completed",
          "name": "taskCompleted",
          "title": "Task Completed Messages",
          "description": "When a task is completed by a worker a message is posted this exchange.\nThis message is routed using the `run-id`, `worker-group` and `worker-id`\nthat completed the task. But information about additional runs is also\navailable from the task status structure.\n\nUpon task completion a result structure is made available, you'll find\nthe url in the `resultURL` property. See _task storage_ documentation for\ndetails on the format of the file available through `resultUrl`.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "`taskId` for the task this message concerns",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "runId",
              "summary": "`runId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 3
            },
            {
              "name": "workerGroup",
              "summary": "`workerGroup` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "workerId",
              "summary": "`workerId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "provisionerId",
              "summary": "`provisionerId` this task is targeted at.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "workerType",
              "summary": "`workerType` this task must run on.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "schedulerId",
              "summary": "`schedulerId` this task was created by.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "taskGroupId",
              "summary": "`taskGroupId` this task was created in.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "routing",
              "summary": "task-specific routing key (`task.routing`).",
              "multipleWords": true,
              "required": true,
              "maxSize": 90
            }
          ],
          "schema": "http://schemas.taskcluster.net/queue/v1/task-completed-message.json#"
        },
        {
          "type": "topic-exchange",
          "exchange": "task-failed",
          "name": "taskFailed",
          "title": "Task Failed Messages",
          "description": "Whenever a task is concluded to be failed a message is posted to this\nexchange. This happens if the task isn't completed before its `deadlìne`,\nall retries failed (i.e. workers stopped responding) or the task was\ncanceled by another entity.\n\nThe specific _reason_ is evident from that task status structure, refer\nto the `reason` property.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "`taskId` for the task this message concerns",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "runId",
              "summary": "`runId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 3
            },
            {
              "name": "workerGroup",
              "summary": "`workerGroup` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "workerId",
              "summary": "`workerId` of latest run for the task, `_` if no run is exists for the task.",
              "multipleWords": false,
              "required": false,
              "maxSize": 22
            },
            {
              "name": "provisionerId",
              "summary": "`provisionerId` this task is targeted at.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "workerType",
              "summary": "`workerType` this task must run on.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "schedulerId",
              "summary": "`schedulerId` this task was created by.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "taskGroupId",
              "summary": "`taskGroupId` this task was created in.",
              "multipleWords": false,
              "required": true,
              "maxSize": 22
            },
            {
              "name": "routing",
              "summary": "task-specific routing key (`task.routing`).",
              "multipleWords": true,
              "required": true,
              "maxSize": 90
            }
          ],
          "schema": "http://schemas.taskcluster.net/queue/v1/task-failed-message.json#"
        }
      ]
    }
  },
  "Scheduler": {
    "referenceUrl": "http://references.taskcluster.net/scheduler/v1/api.json",
    "reference": {
      "version": "0.2.0",
      "title": "Task-Graph Scheduler API Documentation",
      "description": "The task-graph scheduler, typically available at\n`scheduler.taskcluster.net`, is responsible for accepting task-graphs and\nscheduling tasks for evaluation by the queue as their dependencies are\nsatisfied.\n\nThis document describes API end-points offered by the task-graph\nscheduler. These end-points targets the following audience:\n * Post-commit hooks, that wants to submit task-graphs for testing,\n * End-users, who wants to execute a set of dependent tasks, and\n * Tools, that wants to inspect the state of a task-graph.",
      "baseUrl": "https://scheduler.taskcluster.net/v1",
      "entries": [
        {
          "type": "function",
          "method": "put",
          "route": "/task-graph/<taskGraphId>",
          "args": [
            "taskGraphId"
          ],
          "name": "createTaskGraph",
          "title": "Create new task-graph",
          "description": "Create a new task-graph, the `status` of the resulting JSON is a\ntask-graph status structure, you can find the `taskGraphId` in this\nstructure.\n\n**Referencing required tasks**, it is possible to reference other tasks\nin the task-graph that must be completed successfully before a task is\nscheduled. You just specify the `taskId` in the list of `required` tasks.\nSee the example below, where the second task requires the first task.\n```js\n{\n  ...\n  tasks: [\n    {\n      taskId:     \"XgvL0qtSR92cIWpcwdGKCA\",\n      requires:   [],\n      ...\n    },\n    {\n      taskId:     \"73GsfK62QNKAk2Hg1EEZTQ\",\n      requires:   [\"XgvL0qtSR92cIWpcwdGKCA\"],\n      task: {\n        payload: {\n          env: {\n            DEPENDS_ON:  \"XgvL0qtSR92cIWpcwdGKCA\"\n          }\n          ...\n        }\n        ...\n      },\n      ...\n    }\n  ]\n}\n```\n\n**Providing `schedulerId`**, the `schedulerId` on all task definitions\ngiven must be the `schedulerId` for the task-graph scheduler. In\nproduction this is `\"task-graph-scheduler\"`. A task-graph that doesn't\nhave this will not be accepted by the task-graph scheduler.\n\n**Providing `taskGroupId`**, the `taskGroupId` on all task definitions\ngiven must be the `taskGraphId` for this task-graph. A task-graph that\ndoesn't have this will not be accepted by the task-graph scheduler.\n\n**Task-graph scopes**, a task-graph is assigned a set of scopes, just\nlike tasks. Tasks within a task-graph cannot have scopes beyond those\nthe task-graph has. The task-graph scheduler will execute all requests\non behalf of a task-graph using the set of scopes assigned to the\ntask-graph. Thus, if you are submitting tasks to `my-worker-type` under\n`my-provisioner` it's important that your task-graph has the scope\nrequired to define tasks for this `provisionerId` and `workerType`.\nSee the queue for details on permissions required. Note, the task-graph\ndoes not require permissions to schedule the tasks. This is done with\nscopes provided by the task-graph scheduler.",
          "scopes": [
            [
              "scheduler:create-task-graph"
            ]
          ],
          "input": "http://schemas.taskcluster.net/scheduler/v1/task-graph.json#",
          "output": "http://schemas.taskcluster.net/scheduler/v1/task-graph-status-response.json#"
        },
        {
          "type": "function",
          "method": "post",
          "route": "/task-graph/<taskGraphId>/extend",
          "args": [
            "taskGraphId"
          ],
          "name": "extendTaskGraph",
          "title": "Extend existing task-graph",
          "description": "Add a set of tasks to an existing task-graph. The request format is very\nsimilar to the request format for creating task-graphs. But `routing`\nkey, `scopes`, `metadata` and `tags` cannot be modified and tasks added\nto the task-graph will be prefixed with the same routing key as the\nexisting tasks. See `createTaskGraph` for details in routing key\nprefixing.\n\n**Referencing required tasks**, just as when task-graphs are created,\neach task has a list of required tasks. It is possible to reference\nall `taskId`s within the task-graph.\n\n**Safety,** it is only _safe_ to call this API end-point while the\ntask-graph being modified is still running. If the task-graph is\n_finished_ or _blocked_, this method will leave the task-graph in this\nstate. Hence, it is only truly _safe_ to call this API end-point from\nwithin a task in the task-graph being modified.",
          "scopes": [
            [
              "scheduler:extend-task-graph:<taskGraphId>"
            ]
          ],
          "input": "http://schemas.taskcluster.net/scheduler/v1/extend-task-graph-request.json#",
          "output": "http://schemas.taskcluster.net/scheduler/v1/task-graph-status-response.json#"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task-graph/<taskGraphId>/status",
          "args": [
            "taskGraphId"
          ],
          "name": "getTaskGraphStatus",
          "title": "Task Graph Status",
          "description": "Get task-graph status, this will return the _task-graph status\nstructure_. which can be used to check if a task-graph is `running`,\n`blocked` or `finished`.\n\n**Note**, that `finished` implies successfully completion.",
          "output": "http://schemas.taskcluster.net/scheduler/v1/task-graph-status-response.json"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task-graph/<taskGraphId>/info",
          "args": [
            "taskGraphId"
          ],
          "name": "getTaskGraphInfo",
          "title": "Task Graph Information",
          "description": "Get task-graph information, this includes the _task-graph status\nstructure_, along with `metadata` and `tags`, but not information\nabout all tasks.\n\nIf you want more detailed information use the `inspectTaskGraph`\nend-point instead.",
          "output": "http://schemas.taskcluster.net/scheduler/v1/task-graph-info-response.json"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/task-graph/<taskGraphId>/inspect",
          "args": [
            "taskGraphId"
          ],
          "name": "inspectTaskGraph",
          "title": "Inspect Task Graph",
          "description": "Inspect a task-graph, this returns all the information the task-graph\nscheduler knows about the task-graph and the state of its tasks.\n\n**Warning**, some of these fields are borderline internal to the\ntask-graph scheduler and we may choose to change or make them internal\nlater. Also note that note all of the information is formalized yet.\nThe JSON schema will be updated to reflect formalized values, we think\nit's safe to consider the values stable.\n\nTake these considerations into account when using the API end-point,\nas we do not promise it will remain fully backward compatible in\nthe future.",
          "output": "http://schemas.taskcluster.net/scheduler/v1/inspect-task-graph-response.json"
        },
        {
          "type": "function",
          "method": "get",
          "route": "/ping",
          "args": [],
          "name": "ping",
          "title": "Ping Server",
          "description": "Documented later...\n\n**Warning** this api end-point is **not stable**."
        }
      ]
    }
  },
  "SchedulerEvents": {
    "referenceUrl": "http://references.taskcluster.net/scheduler/v1/exchanges.json",
    "reference": {
      "version": "0.2.0",
      "title": "Scheduler AMQP Exchanges",
      "description": "The scheduler, typically available at `scheduler.taskcluster.net` is\nresponsible for accepting task-graphs and schedule tasks on the queue as\ntheir dependencies are completed successfully.\n\nThis document describes the AMQP exchanges offered by the scheduler,\nwhich allows third-party listeners to monitor task-graph submission and\nresolution. These exchanges targets the following audience:\n * Reporters, who displays the state of task-graphs or emails people on\n   failures, and\n * End-users, who wants notification of completed task-graphs\n\n**Remark**, the task-graph scheduler will require that the `schedulerId`\nfor tasks is set to the `schedulerId` for the task-graph scheduler. In\nproduction the `schedulerId` is typically `\"task-graph-scheduler\"`.\nFurthermore, the task-graph scheduler will also require that\n`taskGroupId` is equal to the `taskGraphId`.\n\nCombined these ensures that `schedulerId` and `taskGroupId`\nhave the same position in the routing keys for the queue exchanges.\nSee queue documentation for details on queue exchanges. Hence, making\nit easy to listen for all tasks in a given task-graph.\n\nNote that the first 6 routing key entries used for exchanges on the\ntask-graph scheduler is hardcoded to `_`. This is done to preserve\npositional equivalence with exchanges offered by the queue.",
      "exchangePrefix": "scheduler/v1/",
      "entries": [
        {
          "type": "topic-exchange",
          "exchange": "task-graph-running",
          "name": "taskGraphRunning",
          "title": "Task-Graph Running Message",
          "description": "When a task-graph is submitted it immediately starts running and a\nmessage is posted on this exchange to indicate that a task-graph have\nbeen submitted.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "runId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 3,
              "multipleWords": false
            },
            {
              "name": "workerGroup",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "workerId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "provisionerId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "workerType",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "schedulerId",
              "summary": "Identifier for the task-graphs scheduler managing the task-graph this message concerns. Usually `task-graph-scheduler` in production.",
              "required": true,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "taskGraphId",
              "summary": "Identifier for the task-graph this message concerns",
              "required": true,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "routing",
              "summary": "task-graph specific routing key (`taskGraph.routing`)",
              "multipleWords": true,
              "required": true,
              "maxSize": 64
            }
          ],
          "schema": "http://schemas.taskcluster.net/scheduler/v1/task-graph-running-message.json#"
        },
        {
          "type": "topic-exchange",
          "exchange": "task-graph-extended",
          "name": "taskGraphExtended",
          "title": "Task-Graph Extended Message",
          "description": "When a task-graph is submitted it immediately starts running and a\nmessage is posted on this exchange to indicate that a task-graph have\nbeen submitted.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "runId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 3,
              "multipleWords": false
            },
            {
              "name": "workerGroup",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "workerId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "provisionerId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "workerType",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "schedulerId",
              "summary": "Identifier for the task-graphs scheduler managing the task-graph this message concerns. Usually `task-graph-scheduler` in production.",
              "required": true,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "taskGraphId",
              "summary": "Identifier for the task-graph this message concerns",
              "required": true,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "routing",
              "summary": "task-graph specific routing key (`taskGraph.routing`)",
              "multipleWords": true,
              "required": true,
              "maxSize": 64
            }
          ],
          "schema": "http://schemas.taskcluster.net/scheduler/v1/task-graph-extended-message.json#"
        },
        {
          "type": "topic-exchange",
          "exchange": "task-graph-blocked",
          "name": "taskGraphBlocked",
          "title": "Task-Graph Blocked Message",
          "description": "When a task is completed unsuccessfully and all reruns have been\nattempted, the task-graph will not complete successfully and it's\ndeclared to be _blocked_, by some task that consistently completes\nunsuccessfully.\n\nWhen a task-graph becomes blocked a messages is posted to this exchange.\nThe message features the `taskId` of the task that caused the task-graph\nto become blocked.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "runId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 3,
              "multipleWords": false
            },
            {
              "name": "workerGroup",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "workerId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "provisionerId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "workerType",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "schedulerId",
              "summary": "Identifier for the task-graphs scheduler managing the task-graph this message concerns. Usually `task-graph-scheduler` in production.",
              "required": true,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "taskGraphId",
              "summary": "Identifier for the task-graph this message concerns",
              "required": true,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "routing",
              "summary": "task-graph specific routing key (`taskGraph.routing`)",
              "multipleWords": true,
              "required": true,
              "maxSize": 64
            }
          ],
          "schema": "http://schemas.taskcluster.net/scheduler/v1/task-graph-blocked-message.json#"
        },
        {
          "type": "topic-exchange",
          "exchange": "task-graph-finished",
          "name": "taskGraphFinished",
          "title": "Task-Graph Finished Message",
          "description": "When all tasks of a task-graph have completed successfully, the\ntask-graph is declared to be finished, and a message is posted to this\nexchange.",
          "routingKey": [
            {
              "name": "taskId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "runId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 3,
              "multipleWords": false
            },
            {
              "name": "workerGroup",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "workerId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "provisionerId",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "workerType",
              "summary": "Always takes the value `_`",
              "required": false,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "schedulerId",
              "summary": "Identifier for the task-graphs scheduler managing the task-graph this message concerns. Usually `task-graph-scheduler` in production.",
              "required": true,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "taskGraphId",
              "summary": "Identifier for the task-graph this message concerns",
              "required": true,
              "maxSize": 22,
              "multipleWords": false
            },
            {
              "name": "routing",
              "summary": "task-graph specific routing key (`taskGraph.routing`)",
              "multipleWords": true,
              "required": true,
              "maxSize": 64
            }
          ],
          "schema": "http://schemas.taskcluster.net/scheduler/v1/task-graph-finished-message.json#"
        }
      ]
    }
  }
}