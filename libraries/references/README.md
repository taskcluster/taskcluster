Taskcluster-lib-references is responsible for handling the API reference data,
including manifests, API references, exchange references, and JSON schemas.

It exports a class, `References`, that manages reading and writing this data in
several formats, as well as performing transformations and consistency checks.

It also serves as the canonical repository for a few miscellaneous and
historical schemas.

# Data Formats

## Built Services

This input format corresponds to a directory structure built by
[taskcluster-builder](https://github.com/taskcluster/taskcluster-builder)
during the cluster build process:

```
├── myservice
│   ├── metadata.json
│   ├── references
│   │   ├── events.json
│   │   └── api.json
│   └── schemas
│       └── v1
│           ├── data-description.json
│           └── more-data.json
├── anotherservice
¦   ├── metadata.json
```

This is a subset of the
[taskcluster-lib-docs](https://github.com/taskcluster/taskcluster-lib-docs)
documentation tarball format, and `metadata.json` is defined there.  The
library will load `exchanges.json` as an alternative to `events.json`, if
present.

TODO:
 * events/api.json
   * $schema uri format
   * references to schemas
 * schemas
   * $ref must be relative

*NOTE* the library can only read this format, not write.

## URI-Structured

This data structure looks like the `schemas/` and `references/` URIs within a
Taskcluster rootUrl.

```
├── references
│   ├── manifest.json
│   ├── auth
│   │   └── v1
│   │       ├── api.json
│   │       └── exchanges.json
│   └── ...
└── schemas
    ├── auth
    │   └── v1
    │       ├── authenticate-hawk-request.json
    │       └── ...
    ├── common
    │   ├── action-schema-v1.json
    │   ├── api-reference-v0.json
    │   ├── exchanges-reference-v0.json
    │   └── manifest-v2.json
    └── ...
```

TODO:
 * add a single-JSON-file format

# Abstract and Absolute References

A URI-Structured representation of References can either be "abstract" or
"absolute". The abstract form contains URIs of the form
`taskcluster:/references/..` and `taskcluster:/schemas/..`, abstract from any
specific rootUrl. The absolute form contains URIs that incorporate a specific
rootUrl and thus could actually be fetched with an HTTP GET (in other words,
the URIs are URLs).

The library can load either form, but an in-memory References instance is
always abstract.  Writing an absolute form always requires a rootUrl.

# File Contents

## Manifests

The `references/manifest.json` file contains a JSON document with the following
structure (documented in `manifest-vN.json` as linked from its `$schema`
property):

```json
{
  "services": [
    {
      "serviceName": "someservice",
      "apis": [
        {"version": "v1", "reference": "/references/someservice/v1/api.json"}
      ],
      "pulse": [
        {"version": "v2", "reference": "/references/fake/v2/exchanges.json"}
      ]
    }
  ]
}
```

The services are listed, each with a name and links to the api references and pulse (event) references.
The links (`reference`) are relative to the rootUrl.

## Schemas

Schemas are available at `schemas/<service>/<version>/<name>.json` in the URI-structured format.
The the schema's `$id` contains this path.

## Reference Documents

Reference documents, as generated by `taskcluster-lib-api` and `pulse-publisher`, are available at the URLs referenced from `manifest.json`.
These are the same as the URLs generated by `taskcluster-lib-urls`' `apiReference` and `exchangeReference` functions.

# Development

The usual `yarn` and `yarn test` will run tests for this library.
