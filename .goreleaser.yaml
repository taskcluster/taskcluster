version: 2

builds:
  - main: ./clients/client-shell
    id: taskcluster
    binary: taskcluster
    env:
      - CGO_ENABLED=0
    targets:
      - darwin_amd64
      - darwin_arm64
      - freebsd_amd64
      - freebsd_arm64
      - linux_amd64
      - linux_arm64
      - windows_arm64
      - windows_amd64

  - id: generic-worker-multiuser
    main: ./workers/generic-worker
    binary: generic-worker-multiuser-{{ .Os }}-{{ .Arch }}
    no_unique_dist_dir: true
    env:
      - CGO_ENABLED=0
    tags:
      - multiuser
    ldflags:
      - -X main.revision={{ .FullCommit }}
    goos:
      - windows
    goarch:
      - amd64
      - arm64

  - id: start-worker
    main: ./tools/worker-runner/cmd/start-worker
    binary: start-worker-{{ .Os }}-{{ .Arch }}
    no_unique_dist_dir: true
    env:
      - CGO_ENABLED=0
    goos:
      - windows
    goarch:
      - amd64
      - arm64

  - id: livelog
    main: ./tools/livelog
    binary: livelog-{{ .Os }}-{{ .Arch }}
    no_unique_dist_dir: true
    env:
      - CGO_ENABLED=0
    goos:
      - windows
    goarch:
      - amd64
      - arm64

  - id: taskcluster-proxy
    main: ./tools/taskcluster-proxy
    binary: taskcluster-proxy-{{ .Os }}-{{ .Arch }}
    no_unique_dist_dir: true
    env:
      - CGO_ENABLED=0
    ldflags:
      - -X main.revision={{ .FullCommit }}
    goos:
      - windows
    goarch:
      - amd64
      - arm64

archives:
  - id: taskcluster
    ids:
      - taskcluster

    # Archive name template.
    name_template: "taskcluster-{{ .Os }}-{{ .Arch }}"

    # Can be used to change the archive formats for specific GOOSs.
    # Most common use case is to archive as zip on Windows.
    # Default is empty.
    format_overrides:
      - goos: windows
        formats:
          - zip

    files:
      - none*

  - id: generic-worker-multiuser
    ids:
      - generic-worker-multiuser
    formats:
      - zip
    name_template: "{{ .Binary }}"
    files:
      - none*

  - id: start-worker
    ids:
      - start-worker
    formats:
      - zip
    name_template: "{{ .Binary }}"
    files:
      - none*

  - id: livelog
    ids:
      - livelog
    formats:
      - zip
    name_template: "{{ .Binary }}"
    files:
      - none*

  - id: taskcluster-proxy
    ids:
      - taskcluster-proxy
    formats:
      - zip
    name_template: "{{ .Binary }}"
    files:
      - none*

release:
  # You can disable this pipe in order to not create the release on any SCM.
  # Keep in mind that this might also break things that depend on the release
  # URL, for instance, homebrew taps.
  #
  # Defaults to false.
  disable: false

changelog:
  # Set this to true if you don't want any changelog at all.
  # Warning: this will also ignore any changelog files passed via `--release-notes`,
  # and will render an empty changelog.
  # This may result in an empty release notes on GitHub/GitLab/Gitea.
  disable: true

checksum:
  # Disable the generation/upload of the checksum file.
  # Default is false.
  disable: true

brews:
  - name: taskcluster

    repository:
      owner: taskcluster
      name: homebrew-tap

      # Optionally a token can be provided, if it differs from the token
      # provided to GoReleaser
      token: "{{ .Env.GH_TOKEN }}"

    # Allows you to set a custom download strategy. Note that you'll need
    # to implement the strategy and add it to your tap repository.
    # Example: https://docs.brew.sh/Formula-Cookbook#specifying-the-download-strategy-explicitly
    # Default is empty.
    download_strategy: CurlDownloadStrategy

    # The project name and current git tag are used in the format string.
    commit_msg_template: "Brew formula update for taskcluster version {{ .Tag }}"

    # Directory inside the repository to put the formula.
    # Default is the root directory.
    directory: Formula

    # Your app's homepage.
    # Default is empty.
    homepage: "https://github.com/taskcluster/taskcluster/tree/main/clients/client-shell"

    url_template: "https://github.com/taskcluster/taskcluster/releases/download/{{ .Tag }}/{{ .ArtifactName }}"

    # Template of your app's description.
    # Default is empty.
    description: "A Taskcluster client library for the command line"

    # SPDX identifier of your app's license.
    # Default is empty.
    license: "MPL-2.0"

    # So you can `brew test` your formula.
    # Default is empty.
    test: |
      system "#{bin}/taskcluster version"

chocolateys:
  - name: taskcluster
    ids:
      - taskcluster
    owners: Mozilla
    authors: Mozilla Taskcluster Team
    project_url: "https://github.com/taskcluster/taskcluster/tree/main/clients/client-shell"
    url_template: "https://github.com/taskcluster/taskcluster/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
    icon_url: "https://avatars.githubusercontent.com/u/13954054"
    copyright: "Mozilla"
    license_url: "https://github.com/taskcluster/taskcluster/blob/main/LICENSE"
    require_license_acceptance: false
    project_source_url: "https://github.com/taskcluster/taskcluster"
    docs_url: "https://docs.taskcluster.net/"
    bug_tracker_url: "https://github.com/taskcluster/taskcluster/issues"
    tags: "taskcluster cli mozilla"
    summary: "Taskcluster command-line client"
    description: "A Taskcluster client library for the command line"
    release_notes: "https://github.com/taskcluster/taskcluster/releases/tag/{{ .Tag }}"
    api_key: "{{ .Env.CHOCOLATEY_API_KEY }}"
    source_repo: "https://push.chocolatey.org/"

  - name: generic-worker
    ids:
      - generic-worker-multiuser
    owners: Mozilla
    authors: Mozilla Taskcluster Team
    project_url: "https://github.com/taskcluster/taskcluster/tree/main/workers/generic-worker"
    url_template: "https://github.com/taskcluster/taskcluster/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
    icon_url: "https://avatars.githubusercontent.com/u/13954054"
    copyright: "Mozilla"
    license_url: "https://github.com/taskcluster/taskcluster/blob/main/LICENSE"
    require_license_acceptance: false
    project_source_url: "https://github.com/taskcluster/taskcluster"
    docs_url: "https://docs.taskcluster.net/docs/reference/workers/generic-worker"
    bug_tracker_url: "https://github.com/taskcluster/taskcluster/issues"
    tags: "taskcluster generic-worker mozilla worker"
    summary: "Taskcluster Generic Worker"
    description: "A worker for Taskcluster that can run on any platform"
    release_notes: "https://github.com/taskcluster/taskcluster/releases/tag/{{ .Tag }}"
    api_key: "{{ .Env.CHOCOLATEY_API_KEY }}"
    source_repo: "https://push.chocolatey.org/"

  - name: start-worker
    ids:
      - start-worker
    owners: Mozilla
    authors: Mozilla Taskcluster Team
    project_url: "https://github.com/taskcluster/taskcluster/tree/main/tools/worker-runner"
    url_template: "https://github.com/taskcluster/taskcluster/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
    icon_url: "https://avatars.githubusercontent.com/u/13954054"
    copyright: "Mozilla"
    license_url: "https://github.com/taskcluster/taskcluster/blob/main/LICENSE"
    require_license_acceptance: false
    project_source_url: "https://github.com/taskcluster/taskcluster"
    docs_url: "https://docs.taskcluster.net/docs/reference/workers/worker-runner"
    bug_tracker_url: "https://github.com/taskcluster/taskcluster/issues"
    tags: "taskcluster worker-runner mozilla worker"
    summary: "Taskcluster Worker Runner"
    description: "Start-worker handles worker startup, configuration, and credential management"
    release_notes: "https://github.com/taskcluster/taskcluster/releases/tag/{{ .Tag }}"
    api_key: "{{ .Env.CHOCOLATEY_API_KEY }}"
    source_repo: "https://push.chocolatey.org/"

  - name: livelog
    ids:
      - livelog
    owners: Mozilla
    authors: Mozilla Taskcluster Team
    project_url: "https://github.com/taskcluster/taskcluster/tree/main/tools/livelog"
    url_template: "https://github.com/taskcluster/taskcluster/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
    icon_url: "https://avatars.githubusercontent.com/u/13954054"
    copyright: "Mozilla"
    license_url: "https://github.com/taskcluster/taskcluster/blob/main/LICENSE"
    require_license_acceptance: false
    project_source_url: "https://github.com/taskcluster/taskcluster"
    docs_url: "https://docs.taskcluster.net/"
    bug_tracker_url: "https://github.com/taskcluster/taskcluster/issues"
    tags: "taskcluster livelog mozilla logging"
    summary: "Taskcluster Livelog"
    description: "Live log streaming for Taskcluster tasks"
    release_notes: "https://github.com/taskcluster/taskcluster/releases/tag/{{ .Tag }}"
    api_key: "{{ .Env.CHOCOLATEY_API_KEY }}"
    source_repo: "https://push.chocolatey.org/"

  - name: taskcluster-proxy
    ids:
      - taskcluster-proxy
    owners: Mozilla
    authors: Mozilla Taskcluster Team
    project_url: "https://github.com/taskcluster/taskcluster/tree/main/tools/taskcluster-proxy"
    url_template: "https://github.com/taskcluster/taskcluster/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
    icon_url: "https://avatars.githubusercontent.com/u/13954054"
    copyright: "Mozilla"
    license_url: "https://github.com/taskcluster/taskcluster/blob/main/LICENSE"
    require_license_acceptance: false
    project_source_url: "https://github.com/taskcluster/taskcluster"
    docs_url: "https://docs.taskcluster.net/"
    bug_tracker_url: "https://github.com/taskcluster/taskcluster/issues"
    tags: "taskcluster proxy mozilla"
    summary: "Taskcluster Proxy"
    description: "HTTP proxy for Taskcluster API authentication"
    release_notes: "https://github.com/taskcluster/taskcluster/releases/tag/{{ .Tag }}"
    api_key: "{{ .Env.CHOCOLATEY_API_KEY }}"
    source_repo: "https://push.chocolatey.org/"
